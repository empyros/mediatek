#include <mach/mt_typedefs.h>

#define TEMPERATURE_T0                  110
#define TEMPERATURE_T1                  0
#define TEMPERATURE_T2                  25
#define TEMPERATURE_T3                  50
#define TEMPERATURE_T                   255 // This should be fixed, never change the value

#define FG_METER_RESISTANCE 	0

#define MAX_BOOTING_TIME_FGCURRENT	1*10 // 10s

#if defined(CONFIG_POWER_EXT)
#define OCV_BOARD_COMPESATE	72 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
#else
#define OCV_BOARD_COMPESATE	0 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
#endif

#define Q_MAX_POS_50	2446
#define Q_MAX_POS_25	2408
#define Q_MAX_POS_0		1649
#define Q_MAX_NEG_10	1312

#define Q_MAX_POS_50_H_CURRENT	2443
#define Q_MAX_POS_25_H_CURRENT	2400
#define Q_MAX_POS_0_H_CURRENT	1594
#define Q_MAX_NEG_10_H_CURRENT	1032

#define R_FG_VALUE 				20 // mOhm, base is 20
#define CURRENT_DETECT_R_FG	100  //10mA

#define OSR_SELECT_7			0

#define CAR_TUNE_VALUE			97 //1.00

/////////////////////////////////////////////////////////////////////
// <DOD, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _BATTERY_PROFILE_STRUC
{
    kal_int32 percentage;
    kal_int32 voltage;
} BATTERY_PROFILE_STRUC, *BATTERY_PROFILE_STRUC_P;

typedef enum
{
    T1_0C,
    T2_25C,
    T3_50C
} PROFILE_TEMPERATURE;

// T0 -10C
BATTERY_PROFILE_STRUC battery_profile_t0[] =
{
	{0  , 4193},
	{4  , 4181},
	{8  , 4162},
	{11 , 4143},
	{15 , 4118},
	{19 , 4096},
	{23 , 4079},
	{27 , 4065},
	{30 , 4050},
	{34 , 4030},
	{38 , 4007},
	{42 , 3974},
	{46 , 3931},
	{49 , 3894},
	{53 , 3871},
	{57 , 3855},
	{61 , 3840},
	{65 , 3826},
	{68 , 3808},
	{72 , 3789},
	{76 , 3771},
	{80 , 3753},
	{84 , 3736},
	{88 , 3718},
	{91 , 3697},
	{95 , 3670},
	{97 , 3625},
	{98 , 3600},  
	{98 , 3583}, 
	{99 , 3569},
	{99 , 3560},
	{99 , 3554},  
	{99 , 3549},
	{99 , 3545},
	{99 , 3542},
	{100, 3540},
	{100, 3537},
	{100, 3536},
	{100, 3534},
	{100, 3533},
	{100, 3532},
	{100, 3531},
	{100, 3530},
	{100, 3529},
	{100, 3529},
	{100, 3528},
	{100, 3527},
	{100, 3527},
  {100, 3527},
  {100, 3526},
  {100, 3526},
  {100, 3526},
  {100, 3525},
  {100, 3524},
  {100, 3524},
  {100, 3523},
  {100, 3522},
  {100, 3521},
  {100, 3521},
  {100, 3520},
  {100, 3400}
};      
        
// T1 0C
BATTERY_PROFILE_STRUC battery_profile_t1[] =
{
	{0  , 4195},
	{3  , 4187},
	{6  , 4166},
	{9  , 4145},
	{12 , 4115},
	{15 , 4082},
	{18 , 4049},
	{21 , 4007},
	{24 , 3977},
	{27 , 3955},
	{30 , 3935},
	{33 , 3916},
	{36 , 3899},
	{39 , 3885},
	{42 , 3872},
	{45 , 3860},
	{48 , 3849},
	{51 , 3840},
	{55 , 3830},
	{58 , 3820},
	{61 , 3809},
	{64 , 3799},
	{67 , 3788},
	{70 , 3777},
	{73 , 3766},
	{76 , 3752},
	{79 , 3739},
	{82 , 3726},  
	{85 , 3714}, 
	{88 , 3705},
	{91 , 3695},
	{94 , 3678},  
	{97 , 3637},
	{99 , 3550},
	{99 , 3450},
  {100, 3426},
  {100, 3415},
  {100, 3409},
  {100, 3405},
  {100, 3402},
  {100, 3401},
  {100, 3399},
  {100, 3399},
  {100, 3398},
  {100, 3398},
  {100, 3397},
  {100, 3397},
  {100, 3396},
  {100, 3396},
  {100, 3396},
  {100, 3396},
  {100, 3396},
  {100, 3395},
  {100, 3395},
  {100, 3395},
  {100, 3395},
  {100, 3394},
  {100, 3394},
  {100, 3393},
  {100, 3393},
  {100, 3392}
};

// T2 25C
BATTERY_PROFILE_STRUC battery_profile_t2[] =
{
	{0  , 4195},
	{2  , 4178},
	{4  , 4151},
	{6  , 4128},
	{8  , 4108},
	{10 , 4089},
	{12 , 4072},
	{15 , 4054},
	{17 , 4036},
	{19 , 4019},
	{21 , 4004},
	{23 , 3988},
	{25 , 3975},
	{27 , 3960},
	{29 , 3947},
	{31 , 3934},
	{33 , 3921},
	{35 , 3908},
	{37 , 3893},
	{39 , 3877},
	{41 , 3860},
	{44 , 3848},
	{46 , 3835},
	{48 , 3826},
	{50 , 3817},
	{52 , 3810},
	{54 , 3804},
	{56 , 3798},  
	{58 , 3793}, 
	{60 , 3788},
	{62 , 3783},
	{64 , 3778},  
	{66 , 3775},
	{68 , 3772},
	{71 , 3767},
	{73 , 3763},
	{75 , 3757},
	{77 , 3751},
	{79 , 3744},
	{81 , 3737},
	{83 , 3730},
	{85 , 3719},
	{87 , 3709},
	{89 , 3695},
	{91 , 3686},
	{93 , 3681},
	{95 , 3674},
	{97 , 3634},
  {100, 3540},
  {100, 3374},
  {100, 3308},
  {100, 3289},
  {100, 3281},
  {100, 3276},
  {100, 3273},
  {100, 3271},
  {100, 3270},
  {100, 3269},
  {100, 3269},
  {100, 3268},
  {100, 3268}
}; 

// T3 50C
BATTERY_PROFILE_STRUC battery_profile_t3[] =
{
	{0  , 4196},
	{2  , 4185},
	{4  , 4167},
	{6  , 4145},
	{8  , 4125},
	{10 , 4106},
	{12 , 4087},
	{14 , 4069},
	{16 , 4051},
	{18 , 4034},
	{20 , 4017},
	{22 , 4001},
	{24 , 3985},
	{26 , 3971},
	{29 , 3956},
	{31 , 3943},
	{33 , 3930},
	{35 , 3917},
	{37 , 3905},
	{39 , 3893},
	{41 , 3879},  
	{43 , 3862}, 
	{45 , 3842},
	{47 , 3827},  
	{49 , 3816},
	{51 , 3807},
	{53 , 3800},
	{55 , 3793},
	{57 , 3787},
	{59 , 3782},
	{61 , 3778},
	{63 , 3774},
	{65 , 3770},
	{67 , 3767},
	{69 , 3765},
	{71 , 3761},
  {73 , 3751},
  {75 , 3747},
  {77 , 3742},
  {79 , 3734},
  {81 , 3725},
  {84 , 3718},
  {86 , 3703},
  {88 , 3684},
  {90 , 3668},
  {92 , 3659},
  {94 , 3648},
  {96 , 3631},
  {98 , 3590},
  {100, 3494},
  {100, 3312},
  {100, 3256},
  {100, 3249},
  {100, 3245},
  {100, 3243},
  {100, 3243},
  {100, 3243},
  {100, 3242},
  {100, 3242},
  {100, 3241},
  {100, 3241}
};              

// battery profile for actual temperature. The size should be the same as T1, T2 and T3
BATTERY_PROFILE_STRUC battery_profile_temperature[] =
{
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0}
};    

/////////////////////////////////////////////////////////////////////
// <Rbat, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _R_PROFILE_STRUC
{
    kal_int32 resistance; // Ohm
    kal_int32 voltage;
} R_PROFILE_STRUC, *R_PROFILE_STRUC_P;

// T0 -10C
R_PROFILE_STRUC r_profile_t0[] =
{
	{278 , 4193},
	{278 , 4181},
	{250 , 4162},
	{258 , 4143},
	{258 , 4118},
	{260 , 4096},
	{265 , 4079},
	{270 , 4065},
	{278 , 4050},
	{313 , 4030},
	{373 , 4007},
	{538 , 3974},
	{770 , 3931},
	{855 , 3894},
	{875 , 3871},
	{875 , 3855},
	{878 , 3840},
	{888 , 3826},
	{885 , 3808},
	{883 , 3789},
	{885 , 3771},
	{903 , 3753},
	{925 , 3736},
	{948 , 3718},
	{973 , 3697},
	{1003 , 3670},
	{1043 , 3625},
	{1003 , 3600},  
	{960 , 3583}, 
	{928 , 3569},
	{900 , 3560},
	{885 , 3554},  
	{873 , 3549},
	{868 , 3545},
	{858 , 3542},
	{853, 3540},
	{845, 3537},
	{843, 3536},
	{840, 3534},
	{838, 3533},
	{838, 3532},
	{835, 3531},
	{828, 3530},
	{825, 3529},
	{828, 3529},
	{823, 3528},
	{828, 3527},
	{823, 3527},
  {820, 3527},
  {825, 3526},
  {818, 3526},
  {823, 3526},
  {820, 3525},
  {828, 3524},
  {830, 3524},
  {825, 3523},
  {823, 3522},
  {823, 3521},
  {813, 3521},
  {825, 3520},
  {528, 3400}
};

// T1 0C
R_PROFILE_STRUC r_profile_t1[] =
{
	{220 , 4195},
	{220 , 4187},
	{173 , 4166},
	{175 , 4145},
	{175 , 4115},
	{205 , 4082},
	{255 , 4049},
	{393 , 4007},
	{500 , 3977},
	{510 , 3955},
	{510 , 3935},
	{508 , 3916},
	{505 , 3899},
	{508 , 3885},
	{505 , 3872},
	{508 , 3860},
	{508 , 3849},
	{515 , 3840},
	{515 , 3830},
	{518 , 3820},
	{518 , 3809},
	{518 , 3799},
	{515 , 3788},
	{515 , 3777},
	{518 , 3766},
	{515 , 3752},
	{510 , 3739},
	{513 , 3726},  
	{520 , 3714}, 
	{543 , 3705},
	{570 , 3695},
	{593 , 3678},  
	{603 , 3637},
	{610 , 3550},
	{625 , 3450},
  {565, 3426},
  {540, 3415},
  {525, 3409},
  {515, 3405},
  {510, 3402},
  {510, 3401},
  {503, 3399},
  {500, 3399},
  {500, 3398},
  {498, 3398},
  {498, 3397},
  {498, 3397},
  {498, 3396},
  {493, 3396},
  {495, 3396},
  {490, 3396},
  {500, 3396},
  {495, 3395},
  {495, 3395},
  {490, 3395},
  {498, 3395},
  {495, 3394},
  {495, 3394},
  {493, 3393},
  {495, 3393},
  {493, 3392}
}; 

// T2 25C
R_PROFILE_STRUC r_profile_t2[] =
{
	{148 , 4195},
	{148 , 4178},
	{178 , 4151},
	{178 , 4128},
	{183 , 4108},
	{183 , 4089},
	{188 , 4072},
	{193 , 4054},
	{193 , 4036},
	{198 , 4019},
	{203 , 4004},
	{203 , 3988},
	{210 , 3975},
	{210 , 3960},
	{215 , 3947},
	{218 , 3934},
	{223 , 3921},
	{220 , 3908},
	{215 , 3893},
	{205 , 3877},
	{195 , 3860},
	{193 , 3848},
	{185 , 3835},
	{185 , 3826},
	{183 , 3817},
	{185 , 3810},
	{188 , 3804},
	{190 , 3798},  
	{193 , 3793}, 
	{195 , 3788},
	{195 , 3783},
	{193 , 3778},  
	{198 , 3775},
	{198 , 3772},
	{198 , 3767},
	{198 , 3763},
	{193 , 3757},
	{193 , 3751},
	{190 , 3744},
	{193 , 3737},
	{195 , 3730},
	{193 , 3719},
	{195 , 3709},
	{190 , 3695},
	{190 , 3686},
	{205 , 3681},
	{230 , 3674},
	{233 , 3634},
  {238, 3540},
  {283, 3374},
  {273, 3308},
  {225, 3289},
  {205, 3281},
  {195, 3276},
  {185, 3273},
  {183, 3271},
  {180, 3270},
  {173, 3269},
  {175, 3269},
  {175, 3268},
  {173, 3268}
}; 

// T3 50C
R_PROFILE_STRUC r_profile_t3[] =
{
	{118 , 4196},
	{118 , 4185},
	{118 , 4167},
	{118 , 4145},
	{118 , 4125},
	{120 , 4106},
	{120 , 4087},
	{123 , 4069},
	{125 , 4051},
	{125 , 4034},
	{125 , 4017},
	{125 , 4001},
	{125 , 3985},
	{130 , 3971},
	{130 , 3956},
	{135 , 3943},
	{140 , 3930},
	{143 , 3917},
	{148 , 3905},
	{155 , 3893},
	{158 , 3879},  
	{153 , 3862}, 
	{133 , 3842},
	{123 , 3827},  
	{118 , 3816},
	{120 , 3807},
	{123 , 3800},
	{123 , 3793},
	{123 , 3787},
	{130 , 3782},
	{130 , 3778},
	{135 , 3774},
	{133 , 3770},
	{135 , 3767},
	{140 , 3765},
	{138 , 3761},
  {123 , 3751},
  {128 , 3747},
  {130 , 3742},
  {125 , 3734},
  {125 , 3725},
  {130 , 3718},
  {130 , 3703},
  {128 , 3684},
  {128 , 3668},
  {128 , 3659},
  {133 , 3648},
  {145 , 3631},
  {153 , 3590},
  {155, 3494},
  {155, 3312},
  {140, 3256},
  {123, 3249},
  {118, 3245},
  {113, 3243},
  {110, 3243},
  {105, 3243},
  {108, 3242},
  {110, 3242},
  {105, 3241},
  {103, 3241}
}; 

// r-table profile for actual temperature. The size should be the same as T1, T2 and T3
R_PROFILE_STRUC r_profile_temperature[] =
{
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0}
};     


int fgauge_get_saddles(void);
BATTERY_PROFILE_STRUC_P fgauge_get_profile(kal_uint32 temperature);

int fgauge_get_saddles_r_table(void);
R_PROFILE_STRUC_P fgauge_get_profile_r_table(kal_uint32 temperature);

//#define CONFIG_POWER_VERIFY